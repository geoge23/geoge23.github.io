---
name: Late Attendance System
shortDesc: A project commissioned by my school to manage late arrivals using a mobile interface. Uses a rolling QR code system to prevent late spoofing
icon: ../images/late-checkin-logo.png
type: personal project
images: 
    - ../images/late-checkin-1.png
    - ../images/late-checkin-2.png
    - ../images/late-checkin-3.png
technologies:
    - NodeJS
    - Express
    - TOTP
    - QR Codes
    - Digital Signage
---

The Late Attendance System was built as a digital drop-in replacement for the physical late passes used at my school. The project was commissioned by the Woodward Dean of Students following the widespread success of WADaily, and it was designed to reduce the long wait times for late passes on days with particularly bad traffic or other external factors. 

To provide students with mobile late passes, the front desk requested a QR-based system. However, such a system with a static QR would allow people to retain the link and use it to acquire late passes without actually checking in. To solve this problem, I utilized a rolling QR system based on the TOTP standard for two-factor authentication. TOTP uses the current time along with a secret key to generate 6-8 digit codes valid for a variable amount of time (typically 30 seconds). These codes can later be authenticated by a server to ensure a user generated a code using the secret key at a specified time. I implemented a premade TOTP library along with some additional algorithms from the TOTP RFC and coupled this code with a QR generation library to create a rolling QR code that regenerates every 30 seconds with a new TOTP code. This webpage was then added to a NodeJS server which injects the TOTP secret key and configuration information that’s stored on the server, allowing codes to be generated on-device. This site is then displayed on a Raspberry Pi running Screenly, an open-source digital signage program. The Pi is specifically whitelisted for access to the generation portal. By confining the generator site to a device only available to the front desk, it ensures that the key is only accessible to authorized users with access to the machine, preventing a bad actor from generating their own TOTP codes. 

When a user scans the generated QR code, they are linked to a URL hosted from the NodeJS server. This URL will contain the currently valid TOTP key from the generator as a query parameter, allowing it to be validated by the server. When a user navigates to this page, the server checks if the incoming TOTP code is valid within 1 timeframe (+/- 30 seconds on default settings) of the current system time. This accounts for any discrepancies in the server’s time vs the client’s time. 

If this token is valid, the server will then generate a cookie to allow the user to access their late pass throughout the day, even after revisiting the page. However, cookies are user-modifiable, meaning that a malicious actor could edit their cookie to inform the server that their late pass is valid for a period other than the intended one. In order to prevent such activity, the generated cookie contains both the date of validity for the pass and an HMAC signature generated by the secret key on the server. This means that when a client sends their cookie back to the server, the server can validate that signing the date with its key would yield the same HMAC, thus meaning that the cookie was generated by the server and not tampered with client-side. This HMAC approach has the added benefit of removing the need for a database, since the server can cryptographically verify the authenticity of the cookies on the fly.

The check-in pass screen is generated on the server, meaning that either the TOTP code or HMAC cookie can be validated before displaying the date and time of check-in. The pass also incorporates elements making it easy to validate its authenticity, such as the bar on the top. This bar has an animated gradient that cycles through colors, meaning that when a screenshot is taken, the colors will no longer transition. This design choice prevents malicious actors from screenshotting and photoshopping the pass to make it appear valid, since the animated gradient will no longer transition between colors along the top of the screen. The text was also made extra large to accommodate for harsh viewing conditions, ensuring that teachers can easily read the time and date information on the screen.

Following implementation of this system, there was a significant decrease in both wait times for front desk check-in and wasted paper for late notes. Teachers also reported easier experiences validating pass authenticity overall preferred the new system.
